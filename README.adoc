= Waena

image:https://img.shields.io/github/commits-since/rahulsom/waena/latest?style=for-the-badge[GitHub commits since latest release, link="https://github.com/rahulsom/waena/releases/new"]

Gradle plugins for publishing to Maven Central

== Setup

There are 2 plugins that make up this project.

=== Waena Root

image:https://img.shields.io/gradle-plugin-portal/v/com.github.rahulsom.waena.root?style=for-the-badge[Gradle Plugin Portal, link="https://plugins.gradle.org/plugin/com.github.rahulsom.waena.root"]

This needs to be applied only to the root project.

[source,kotlin]
----
plugins {
  id("com.github.rahulsom.waena.root").version("<VERSION>")
}

allprojects {
  group = "TODO"
}

contacts {
    validateEmails = true
    with(addPerson("todo@noreply.github.com")) {
        moniker("To Do")
        roles("owner")
        github("https://github.com/todo")
    }
}
----

=== Waena Published

image:https://img.shields.io/gradle-plugin-portal/v/com.github.rahulsom.waena.published?style=for-the-badge[Gradle Plugin Portal, link="https://plugins.gradle.org/plugin/com.github.rahulsom.waena.published"]

This needs to be applied to each module in the project that needs to be published.

[source,kotlin]
----
plugins {
  id("com.github.rahulsom.waena.published").version("<VERSION>")
}

description = "TODO"

// Optional (to customize license/publishMode)
// Right now there's only one working publish mode - Central
waena {
    license.set(WaenaExtension.License.Apache2)
    publishMode.set(WaenaExtension.PublishMode.Central)
}
----

== Usage

=== Environment Variables

Set these 4 environment variables

[source,shell]
----
export ORG_GRADLE_PROJECT_sonatypeUsername=???
export ORG_GRADLE_PROJECT_sonatypePassword=???
export ORG_GRADLE_PROJECT_signingKey=???
export ORG_GRADLE_PROJECT_signingPassword=???
----

=== Publishing snapshots

[source,shell]
----
./gradlew snapshot
----

=== Publishing releases

[source,shell]
----
git tag v1.2.3 # Any semver compatible version prefixed by `v`
./gradlew -Prelease.useLastTag=true build final --stacktrace
----

== Implementation Details

Under the hood, this uses several other plugins and ties them all together such that you can release to maven central easily

* link:https://plugins.gradle.org/plugin/nebula.release[nebula.release]
* link:https://plugins.gradle.org/plugin/nebula.maven-publish[nebula.maven-publish]
* link:https://plugins.gradle.org/plugin/nebula.contacts[nebula.contacts]
* link:https://plugins.gradle.org/plugin/nebula.info[nebula.info]
* link:https://plugins.gradle.org/plugin/io.codearte.nexus-staging[nexus-staging]
* link:https://plugins.gradle.org/plugin/de.marcphilipp.nexus-publish[nexus-publish]
